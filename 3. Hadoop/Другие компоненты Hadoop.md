<h2>Другие компоненты экосистемы Hadoop</h2>
<h3>1. Apache Ranger</h3>
<h4>Введение</h4>

Apache Ranger предлагает комплексный фреймворк для управления безопасностью и политиками доступа в Hadoop экосистеме. Он позволяет администраторам легко управлять политиками безопасности для различных служб Hadoop, включая HDFS, HBase, Hive, и другие.

Функции Ranger:
1. Централизованное управление политиками: Администратор может создавать, управлять и применять политики безопасности для всех компонентов (HDFS, Hive, Kafka и т.д.) из единого веб-интерфейса. Политики определяют, кому (пользователь/группа/роль) что разрешено делать (читать, писать, выполнять и т.д.) с каким ресурсом (база данных, таблица, столбец, топик, путь в HDFS).
2. Детализированная авторизация (Authorization): Поддерживает различные уровни контроля доступа:
  - На уровне ресурсов (например, доступ к конкретной папке в HDFS).
  - На уровне столбцов (Column Masking) — маскирование данных в определенных столбцах (например, показывать только последние 4 цифры номера кредитной карты).
  - На уровне строк (Row-Level Filtering) — динамическое фильтрование строк на основе атрибутов пользователя (например, менеджер видит только данные своего отдела).
3. Сквозной аудит (Auditing): Ranger собирает и хранит детальные логи всех событий доступа к данным. Администратор может видеть, кто, когда, к какому ресурсу обращался и была ли операция разрешена или запрещена. Эти логи можно интегрировать с внешними системами мониторинга и SIEM (например, Splunk, ELK Stack).
4. Безопасность на основе тегов (Tag-Based Policies): Эта функция позволяет отделить описание политик от физической структуры данных. С помощью Apache Atlas (система управления метаданными и governance) данные помечаются тегами (например, "PII", "Financial", "Confidential"). В Ranger затем создаются политики для этих тегов ("Только аудиторы могут читать данные с тегом PII"). Это делает политики более гибкими и управляемыми.
5. Шифрование данных (Data Encryption): Интегрируется с проектом Apache Knox для управления ключами шифрования и обеспечения безопасности данных в состоянии покоя (at-rest) и в движении (in-transit).
6. Поддержка стандартов безопасности: Легко интегрируется с корпоративными системами, такими как LDAP/Active Directory для аутентификации пользователей и Kerberos для безопасной аутентификации самих сервисов Hadoop.

<h4>Интеграция и роль в Hadoop</h4>

До появления таких систем, как Ranger, управление безопасностью в Hadoop было децентрализованным и сложным. Каждый компонент (HDFS, Hive, HBase) имел свои собственные, зачастую примитивные, механизмы безопасности (например, POSIX-права в HDFS или права доступа в Hive).

Роль Ranger — стать единым центром компетенции по безопасности для всей экосистемы:
- "Единое окно" для администратора: Вместо настройки прав в каждом сервисе отдельно, админ делает это один раз в UI Ranger.
- Согласованность политик: Обеспечивает, что политики безопасности применяются одинаково ко всем инструментам экосистемы, устраняя "слепые зоны".
- Ускорение compliance: Помогает компаниям соответствовать строгим требованиям регуляторов (таким как GDPR, HIPAA, PCI DSS) за счет централизованного аудита и детализированного контроля доступа.
- Enabler для Self-Service Analytics: Позволяет безопасно предоставлять доступ к данным большим командам аналитиков, не опасаясь утечек, так как доступ можно ограничить на очень тонком уровне (столбец, строка).
- Фактически, Ranger стал де-факто стандартом для управления безопасностью в современных дистрибутивах Hadoop, таких как Cloudera Data Platform (CDP) и Hortonworks (ныне часть Cloudera).

Ranger работает по принципу плагинов (plugins). Для каждого компонента экосистемы существует свой легковесный плагин (Ranger Plugin), который устанавливается на узлы с этими компонентами.

Как это работает:
1. Администратор создает политику в веб-UI Ranger.
2. Плагин на стороне сервиса (например, Hive) периодически опрашивает сервер Ranger (Policy Admin Server) и загружает актуальные политики в кеш.
3. Когда пользователь пытается выполнить запрос (например, SELECT * FROM sales_table), плагин Hive перехватывает этот запрос и проверяет его против закешированных политик.
4. Плагин принимает решение: разрешить или запретить операцию, и записывает событие аудита обратно на сервер Ranger.

Примеры интеграции с ключевыми компонентами:
- Apache HDFS: Доступ к файлам и директориям. Пример политики: Разрешить группе `analysts` только `READ` доступ к пути `/data/sales/`. Запретить группе `contractors` любой доступ к `/data/hr/`.
- Apache Hive: Доступ к базам данных, таблицам, представлениям и столбцам. Возможность выполнять операции (`SELECT`, `UPDATE`, `CREATE`). Пример политики: Разрешить пользователю `john` выполнять `SELECT` по таблице customers, но для столбца `credit_card` применить маскирование (маска `XXXX-XXXX-XXXX-####`).
- Apache HBase: Доступ к пространствам имен (namespaces), таблицам, семействам столбцов (column families) и ячейкам. Пример политики: Разрешить группе `service_team` делать `PUT` и `GET` в таблицу `user_sessions`.
- Apache Kafka: Доступ к топикам (topics), возможность производить (Produce) и потреблять (Consume) сообщения. Пример политики: Разрешить приложению `log_ingester` производить сообщения в топик `app_logs`. Разрешить группе `fraud_detection` потреблять сообщения из топика `transactions`.
- Apache Solr: Доступ к коллекциям (collections), наборам документов и полям. Пример политики: Запретить группе `interns` доступ к коллекции `employee_reviews`.
- YARN: Доступ к очередям (queues) и возможность отправлять задания. Пример политики: Разрешить группе `data_science` отправлять задания в очередь `ml_queue`.
- Apache Atlas: Связка "безопасность + глоссарий данных". Политики на основе тегов, созданных в Atlas. Пример политики: Создать в Atlas тег `PII`. Пометить им таблицы и столбцы с персональными данными. В Ranger создать политику: "Только члены роли `GDPR_Compliance` имеют доступ к ресурсам с тегом `PII`".
- Cloud-хранилища (S3, ADLS): В современных дистрибутивах (CDP) Ranger может управлять доступом к объектам в облачных хранилищах, согласовывая политики Ranger с native ACLs облачных провайдеров.

<h4>Типы данных и политик безопасности</h4>

Apache Ranger предоставляет возможность определять политики доступа для различных типов данных и ресурсов в экосистеме Hadoop. Ресурсы могут быть разными в зависимости от сервиса (HDFS, Hive, HBase, Kafka и т.д.).

Типы данных, для которых Ranger может управлять доступом, включают:
- В HDFS: файлы и директории (пути).
- В Hive: базы данных, таблицы, представления, столбцы и даже операции (`SELECT`, `UPDATE`, `CREATE` и т.д.).
- В HBase: пространства имен, таблицы, семейства столбцов, ячейки.
- В Kafka: топики, группы потребителей, транзакции и т.д.

Политики безопасности в Ranger можно разделить на:
- Политики доступа (Access Policies): Определяют, кто (пользователь или группа) имеет доступ к какому ресурсу и какие действия разрешены. Они могут быть разрешающими (allow) или запрещающими (deny).
- Политики маскирования данных (Data Masking Policies): Применяются к столбцам в Hive или других компонентах, чтобы маскировать чувствительные данные (например, номера кредитных карт) для определенных пользователей. Типы масок: частичное отображение, хеширование, постоянная маска и т.д.
- Политики фильтрации строк (Row-Level Filtering Policies): Позволяют ограничить доступ к строкам в таблице на основе условия (например, пользователь может видеть только строки, где регион равен 'US').

Кроме того, Ranger поддерживает политики на основе тегов (Tag-Based Policies), которые позволяют назначать политики не напрямую на ресурсы, а на теги, присвоенные ресурсам через Apache Atlas. Это обеспечивает более гибкое управление доступом, основанное на классификации данных.

<h4>Настройка политики доступа</h4>

Процесс настройки политики доступа в Ranger обычно выполняется через веб-интерфейс Ranger Admin UI. Рассмотрим пример настройки политики для Hive, шаги:
1. Войдите в веб-интерфейс Ranger (например, `http://ranger-server:6080`).
2. Перейдите к сервису, для которого вы хотите создать политику (например, Hive).
3. Нажмите на кнопку создания новой политики (Add New Policy).
4. Заполните детали политики:
  - Policy Name: Уникальное имя политики.
  - Resource Path: Укажите ресурсы, к которым применяется политика (например, база данных, таблица, столбец). Можно использовать wildcards (например, `sales_*`).
  - Select Group / Select User: Укажите пользователя или группу, для которых применяется политика.
  - Permissions: Выберите разрешения. Для каждого разрешения можно указать, разрешить (Allow) или запретить (Deny).
5. При необходимости настройте условия для маскирования данных или фильтрации строк.
6. Сохраните политику.

После сохранения политика будет распространена на соответствующий сервис (через плагин Ranger) и начнет применяться при следующих запросах.

Управление политиками:
- Редактирование: Можно изменить существующие политики.
- Удаление: Удаление ненужных политик.
- Включение/Отключение: Временное отключение политики без удаления.
- Аудит: Просмотр логов доступа для мониторинга применения политик.

Пример политики в Hive, разрешающей группе `analysts` выполнять `SELECT` ко всем столбцам таблицы `sales` в базе `default`:
```bash
Policy Name: allow-analysts-read-sales
Database: default
Table: sales
Column: *
Group: analysts
Permissions: Select -> Allow
```

<h4>KMS</h4>

KMS (Key Management Server) в контексте Hadoop относится к Hadoop KMS, который является сервером управления ключами для шифрования данных в HDFS. KMS предоставляет API для создания, управления и использования ключей шифрования, а также интегрируется с HDFS для поддержки прозрачного шифрования (HDFS Transparent Encryption).

Связь между Apache Ranger и KMS заключается в том, что Ranger может управлять политиками доступа к ключам шифрования, хранящимися в KMS. Это означает, что Ranger предоставляет авторизацию для операций с ключами в KMS. Например, с помощью Ranger можно определить:
- Кто может создавать, удалять или вращать ключи шифрования.
- Кто может получать метаданные ключей или сам материал ключа.

Как это работает:
1. KMS настроен на аутентификацию с помощью Kerberos и авторизацию через Ranger.
2. Когда пользователь или сервис пытается выполнить операцию с ключом (например, получить ключ для чтения зашифрованного файла), KMS обращается к Ranger для проверки прав доступа.
3. Ranger проверяет политики, определенные для KMS, и возвращает решение о разрешении или запрете операции.
4. Таким образом, Ranger расширяет свои функции управления безопасностью до уровня шифрования, обеспечивая единое место для управления политиками доступа к данным и ключам шифрования.

Пример политики Ranger для KMS:
```bash
Policy Name: allow-cluster-admins-manage-keys
Resource: key (или конкретное имя ключа)
User/Group: cluster-admins
Permissions: Manage -> Allow
```

<h4>Интеграция с Hive</h4>

Интеграция Apache Ranger с Apache Hive позволяет управлять доступом к данным в Hive на уровне баз данных, таблиц, столбцов и даже строк. Ranger предоставляет авторизацию для запросов Hive, а также аудит всех операций.

Для настройки интеграции нужно установить плагин Ranger для Hive на каждый узел, где работает HiveServer2, затем задать конфигурацию в файле hive-site.xml:
```xml
<property>
    <name>hive.security.authorization.manager</name>
    <value>org.apache.ranger.authorization.hive.authorizer.RangerHiveAuthorizerFactory</value>
</property>
<property>
    <name>hive.security.authenticator.manager</name>
    <value>org.apache.hadoop.hive.ql.security.SessionStateUserAuthenticator</value>
</property>
```

Затем нужно перезапустить HiveServer2 и можно будет создавать политики.

<h4>Управление ключами шифрования</h4>

Apache Ranger и Apache Knox вместе обеспечивают безопасность данных в Hadoop, включая управление ключами шифрования. Ranger отвечает за авторизацию и аудит, а Knox предоставляет шлюз для безопасного доступа и управления ключами.

Управление ключами шифрования:
1. Hadoop KMS: Это сервер для управления ключами шифрования в Hadoop. Он поддерживает создание, хранение и управление ключами, используемыми для шифрования данных в HDFS (например, прозрачное шифрование HDFS).
2. Интеграция Ranger с KMS: Ranger может управлять политиками доступа к операциям KMS (например, создание ключа, удаление, получение). Политики Ranger определяют, кто может выполнять операции с ключами.
3. Создание политик Ranger для KMS: В веб-интерфейсе Ranger выберите сервис KMS. Создайте политики для управления ключами.
4. Использование Knox для безопасного доступа к KMS: Knox выступает в роли прокси для KMS, обеспечивая аутентификацию и авторизацию запросов. Клиенты обращаются к KMS через Knox, а Knox проверяет политики Ranger.

Пример потока запроса на получение ключа через Knox и Ranger:
1. Клиент отправляет запрос на получение ключа в Knox.
2. Knox аутентифицирует клиента (например, с помощью LDAP).
3. Knox обращается к Ranger для проверки авторизации (имеет ли клиент право на доступ к ключу).
4. Если разрешено, Knox перенаправляет запрос в KMS.
5. KMS возвращает ключ через Knox клиенту.